databaseChangeLog:
  - changeSet:
      id: 20260214-1
      author: junie
      changes:
        - createTable:
            tableName: T_TOKEN
            columns:
              - column:
                  name: TKN_ID
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: USR_ID
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: TKN_VALUE
                  type: VARCHAR(255)
                  constraints:
                    nullable: false
                    unique: true
              - column:
                  name: TKN_EXPIRY_DATE
                  type: TIMESTAMP
                  constraints:
                    nullable: false
              - column:
                  name: TKN_TYPE
                  type: VARCHAR(50)
                  constraints:
                    nullable: false
              - column:
                  name: TKN_REVOKED
                  type: BOOLEAN
                  defaultValueBoolean: false
                  constraints:
                    nullable: false

  - changeSet:
      id: 20260214-2
      author: junie
      changes:
        - sql:
            dbms: postgresql
            sql: |
              INSERT INTO T_TOKEN (USR_ID, TKN_VALUE, TKN_EXPIRY_DATE, TKN_TYPE, TKN_REVOKED)
              SELECT USR_ID, PRT_TOKEN, PRT_EXPIRY_DATE, 'PASSWORD_RESET', false FROM T_PASSWORD_RESET_TOKEN;

              INSERT INTO T_TOKEN (USR_ID, TKN_VALUE, TKN_EXPIRY_DATE, TKN_TYPE, TKN_REVOKED)
              SELECT USR_ID, RT_TOKEN, RT_EXPIRY_DATE, 'REFRESH', RT_REVOKED FROM T_REFRESH_TOKEN;
        - sql:
            dbms: h2
            sql: |
              INSERT INTO T_TOKEN (USR_ID, TKN_VALUE, TKN_EXPIRY_DATE, TKN_TYPE, TKN_REVOKED)
              SELECT USR_ID, PRT_TOKEN, PRT_EXPIRY_DATE, 'PASSWORD_RESET', FALSE FROM T_PASSWORD_RESET_TOKEN;

              INSERT INTO T_TOKEN (USR_ID, TKN_VALUE, TKN_EXPIRY_DATE, TKN_TYPE, TKN_REVOKED)
              SELECT USR_ID, RT_TOKEN, RT_EXPIRY_DATE, 'REFRESH', RT_REVOKED FROM T_REFRESH_TOKEN;
      failOnError: false

  - changeSet:
      id: 20260214-3
      author: junie
      failOnError: false
      changes:
        - dropTable:
            tableName: T_PASSWORD_RESET_TOKEN
        - dropTable:
            tableName: T_REFRESH_TOKEN
